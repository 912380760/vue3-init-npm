#!/usr/bin/env node
const { program } = require('commander');
const figlet = require('figlet');
const versionStr = figlet.textSync('Lucien');
const Printer = require('@darkobits/lolcatjs');
const shell = require('shelljs');
let json2ts = require('json2ts');
const _version = require('../package.json').version;
const chalk = require('chalk');
const inquirer = require('inquirer');
const ora = require('ora');
const download = require('download-git-repo');
program.version(
  Printer.default.fromString(
    `   \n      vue-initè„šæ‰‹æ¶${_version}\n    \n${versionStr}`
  )
);
program.option('create', 'åˆå§‹åŒ–é¡¹ç›®');
// program.option('-j,json2ts', 'ç”ŸæˆTypeScriptğŸ»');

const create = (otherParmas) => {
  inquirer
      .prompt([
        {
          type: 'text',
          message: 'â‘  è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°',
          name: 'dirname',
        },
        // {
        //   type: 'list',
        //   name: 'jskind',
        //   message: 'â‘¡ è¯·é€‰æ‹©å¼€å‘è¯­è¨€',
        //   choices: ['â˜‰ TypeScript', 'â˜‰ EcmaScript6'],
        // },
      ])
      .then((answers) => {
          // console.log(answers);
        const _pwd = shell.pwd().stdout;
        const projectPath = `${_pwd}/${answers.dirname}`;
        // console.log('ç”¨æˆ·çš„å…¨è·¯å¾„', projectPath, answers.jskind);
        shell.rm('-rf', projectPath);
        shell.mkdir(projectPath);
        const spinner = ora('â° downloading template.....');
        spinner.start();
        const template =
            'direct:https://github.com/912380760/vue3-init.git';
        download(template, projectPath, { clone: true }, function (err) {
          spinner.stop();
          // æç¤ºç”¨æˆ·æ‰“å¼€æ–‡ä»¶å¤¹å’Œå®‰è£…ä¾èµ–
          console.log(chalk.blue(`cd ${answers.dirname} \nyarn or npm install`))
          // if (err) {
          //   //gitä¸‹è½½ä¼šæŠ¥é”™,ä½†æ˜¯ä¸‹è½½æ˜¯æˆåŠŸçš„
          //   console.log(typeof err);
          //   console.log(chalk.red('ä¸‹è½½å¤±è´¥ğŸ˜­'));
          // } else {
          //   shell.sed(
          //       '-i',
          //       'vue3-init',
          //       answers.dirname,
          //       projectPath + '/package.json'
          //   );
          // }
        });
      });
}

const bindHandler = {
  create,
  // json2ts(url) {
  //   const data = {
  //     yideng: 'laoyuan',
  //     data: {
  //       age: 30 || '',
  //     },
  //   };
  //   const jsonContent = JSON.stringify(data);
  //   let result = json2ts.convert(jsonContent);
  //   console.log(result);
  // },
};
program
  .usage('[cmd] <options>')
  .arguments('<cmd> [env]')
  .action(function (cmd, otherParmas) {
    const handler = bindHandler[cmd];
    // console.log(cmd, otherParmas);
    if (typeof handler === 'undefined') {
      console.log(chalk.blue(`${cmd}`) + chalk.red('æš‚æœªæ”¯æŒ'));
    } else {
      handler(otherParmas);
    }
    // console.log('cmd', cmd);
    // console.log('otherParmas', otherParmas);
  });
program.parse(process.argv);
